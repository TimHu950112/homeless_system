# 餐券 QR Code 系統使用說明

## 📋 功能概述

餐券 QR Code 系統提供完整的數位餐券解決方案，包括：
- 🎫 自動生成 QR Code
- 📱 線上驗證功能
- 📷 相機掃描支援
- ⌨️ 手動輸入驗證

---

## 🎨 主要功能

### 1. **餐券顯示頁面** (`/food/my-vouchers`)

**功能特色：**
- ✅ 每張未使用餐券自動生成 QR Code
- ✅ 餐券卡片美化設計（漸層背景、絲帶標籤）
- ✅ 即時顯示可用/已用餐券統計
- ✅ 支援下載單張 QR Code 圖片
- ✅ 分階段動畫效果

**使用對象：** 一般用戶

**視覺設計：**
- 未使用餐券：漸層藍色標題 + "可使用" 絲帶
- 已使用餐券：灰色標題 + 半透明效果
- QR Code 顯示在卡片中央，帶脈衝動畫

---

### 2. **QR Code 驗證頁面** (`/food/verify-voucher`)

**功能特色：**
- 📷 **相機掃描**：使用 HTML5 QR Code Scanner
  - 即時掃描餐券 QR Code
  - 綠色掃描線動畫效果
  - 自動停止掃描

- ⌨️ **手動輸入**：
  - 輸入餐券編號
  - 輸入餐廳名稱
  - 快速驗證

- ✅ **驗證結果顯示**：
  - 成功：綠色卡片 + 餐券詳情
  - 失敗：紅色卡片 + 錯誤原因
  - 平滑滑入動畫

**使用對象：** 社工、管理員（餐廳人員）

**驗證邏輯：**
1. 檢查餐券是否存在
2. 檢查餐券是否已使用
3. 檢查餐券是否過期
4. 標記為已使用並記錄使用資訊

---

## 🔧 技術實現

### 後端 (Python/Flask)

**依賴套件：**
```
qrcode[pil]  # QR Code 生成
Pillow       # 圖像處理
```

**主要函數：**

1. **生成 QR Code** (`my_vouchers`)
```python
# QR Code 數據格式
qr_data = {
    'voucher_id': int,
    'user_id': int,
    'meal_type': str,
    'issued_date': str,
    'expiry_date': str
}
```

2. **驗證餐券** (`verify_voucher`)
- 解析 QR Code 數據
- 驗證餐券有效性
- 更新使用狀態
- 返回 JSON 響應

### 前端技術

**使用技術：**
- HTML5 QR Code Scanner (html5-qrcode@2.3.8)
- Bootstrap 5
- AOS 動畫庫
- 自定義 CSS 動畫

**關鍵功能：**
- 相機權限請求
- 即時掃描回饋
- AJAX 驗證請求
- 動態結果顯示

---

## 📱 使用流程

### 用戶端流程

1. **查看餐券**
   - 登入後前往 `/food/my-vouchers`
   - 查看所有餐券及 QR Code

2. **出示餐券**
   - 向餐廳人員展示 QR Code
   - 或下載 QR Code 圖片

### 餐廳端流程

1. **開啟驗證頁面**
   - 社工/管理員登入
   - 前往 `/food/verify-voucher`

2. **掃描 QR Code**
   - 點擊「開始掃描」
   - 對準用戶的 QR Code
   - 等待自動識別

3. **查看結果**
   - 驗證成功：綠色提示 + 餐券資訊
   - 驗證失敗：紅色提示 + 失敗原因

4. **繼續驗證**
   - 點擊「驗證下一張」重置

---

## 🎨 視覺設計特色

### 餐券卡片設計
- **卡片 hover 效果**：上浮 + 陰影增強
- **絲帶標籤**：45度旋轉的「可使用」標籤
- **QR Code 容器**：白色背景 + 圓角 + 陰影
- **脈衝動畫**：QR Code 輕微跳動效果

### 驗證頁面設計
- **掃描線動畫**：綠色光線從上到下掃描
- **視頻容器**：圓角 + 大陰影
- **結果卡片**：滑入動畫
- **圖標展示**：大型彩色圖標 + 統計資訊

### 色彩方案
- **主色調**：漸層藍色 (#0d6efd → #0dcaf0)
- **成功色**：綠色 (#198754)
- **警告色**：黃色 (#ffc107)
- **危險色**：紅色 (#dc3545)

---

## 🔐 安全性考量

1. **權限控制**
   - 只有登入用戶可查看自己的餐券
   - 只有社工/管理員可驗證餐券

2. **數據驗證**
   - 檢查餐券所有權
   - 驗證過期時間
   - 防止重複使用

3. **QR Code 安全**
   - JSON 格式數據
   - 包含多重驗證欄位
   - 無法偽造（需資料庫記錄）

---

## 📊 資料庫欄位

**meal_vouchers 表：**
```json
{
    "id": int,
    "user_id": int,
    "meal_type": str,
    "issued_date": str (ISO format),
    "expiry_date": str (ISO format),
    "is_used": bool,
    "used_date": str (ISO format),
    "provider_name": str,
    "created_at": str,
    "updated_at": str
}
```

---

## 🚀 安裝與部署

### 1. 安裝依賴
```bash
pip install -r requirements.txt
```

### 2. 啟動應用
```bash
python run.py
```

### 3. 訪問頁面
- 餐券頁面：http://localhost:5500/food/my-vouchers
- 驗證頁面：http://localhost:5500/food/verify-voucher

---

## 📝 測試建議

### 測試場景

1. **正常使用流程**
   - 用戶查看餐券
   - 掃描 QR Code 驗證成功

2. **錯誤處理**
   - 掃描已使用的餐券
   - 掃描過期的餐券
   - 手動輸入錯誤編號

3. **相機權限**
   - 拒絕相機權限
   - 不同設備測試（手機/電腦）

---

## 🎯 未來改進方向

1. **功能增強**
   - [ ] 批量驗證功能
   - [ ] 驗證歷史記錄
   - [ ] 統計報表

2. **體驗優化**
   - [ ] PWA 支援（離線使用）
   - [ ] 震動回饋
   - [ ] 聲音提示

3. **安全加固**
   - [ ] 加密 QR Code 數據
   - [ ] 時間戳驗證
   - [ ] IP 白名單

---

## 📞 支援與回饋

如有問題或建議，請聯繫開發團隊。

**重要提醒：**
- 確保瀏覽器支援相機功能（HTTPS 環境）
- 建議使用最新版 Chrome/Safari/Edge
- 手機端體驗更佳

---

✨ **QR Code 餐券系統 v1.0**
